# æ¶ˆæ¯è·¯ç”±404é—®é¢˜ä¿®å¤

## é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Šå‘é€æ¶ˆæ¯åï¼Œé¡µé¢æ˜¾ç¤º404é”™è¯¯ï¼Œè®¿é—®çš„URLæ ¼å¼ä¸ºï¼š
```
/messages/b56d1299-e161-4b6e-bc66-edfda3d0d4d8-d7075cc4-0915-4ac3-a6ea-9e4513264288
```

## é—®é¢˜åˆ†æ

é€šè¿‡ä»£ç å®¡æŸ¥å‘ç°ï¼Œæ¶ˆæ¯è·¯ç”±å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

### 1. è·¯ç”±æ ¼å¼ä¸åŒ¹é…
- **æ¶ˆæ¯å‘é€åé‡å®šå‘**: `/messages/${product.id}-${seller.id}`
- **å®é™…è·¯ç”±æ–‡ä»¶**: `/app/messages/[conversationId]/page.tsx`
- **URLè§£æé—®é¢˜**: æ—§è·¯ç”±ä½¿ç”¨è¿å­—ç¬¦åˆ†éš”ï¼Œä½†è§£æé€»è¾‘æœ‰é—®é¢˜

### 2. è·¯ç”±å‚æ•°æ··ä¹±
- **æ—§æ ¼å¼**: `[conversationId]` éœ€è¦æ‰‹åŠ¨è§£æ `productId` å’Œ `partnerId`
- **æ–°æ ¼å¼**: `[productId]/[partnerId]` æ›´æ¸…æ™°ï¼Œå‚æ•°åˆ†ç¦»

### 3. è·¯ç”±å†²çª
- å­˜åœ¨ä¸¤ä¸ªè·¯ç”±æ–‡ä»¶å¤„ç†ç›¸åŒçš„åŠŸèƒ½
- å¯èƒ½å¯¼è‡´Next.jsè·¯ç”±å†²çª

## ä¿®å¤æ–¹æ¡ˆ

### 1. é‡æ–°è®¾è®¡è·¯ç”±ç»“æ„

#### **æ—§è·¯ç”±ç»“æ„**:
```
/messages/[conversationId] â†’ /messages/productId-partnerId
```

#### **æ–°è·¯ç”±ç»“æ„**:
```
/messages/[productId]/[partnerId] â†’ /messages/productId/partnerId
```

### 2. åˆ›å»ºæ–°çš„å¯¹è¯é¡µé¢

åˆ›å»ºäº† `app/messages/[productId]/[partnerId]/page.tsx`ï¼š

```typescript
export default async function ConversationPage({
  params,
}: {
  params: { productId: string; partnerId: string }
}) {
  const { productId, partnerId } = params
  
  // ç›´æ¥ä½¿ç”¨åˆ†ç¦»çš„å‚æ•°ï¼Œæ— éœ€è§£æ
  // æ›´æ¸…æ™°çš„æƒé™éªŒè¯é€»è¾‘
  // æ›´å¥½çš„é”™è¯¯å¤„ç†
}
```

### 3. æ›´æ–°æ¶ˆæ¯å‘é€é‡å®šå‘

ä¿®æ”¹äº† `components/messages/new-message-form.tsx`ï¼š

```typescript
// ä¿®å¤å‰
const conversationId = `${product.id}-${seller.id}`
router.push(`/messages/${conversationId}`)

// ä¿®å¤å
router.push(`/messages/${product.id}/${seller.id}`)
```

### 4. æ›´æ–°æ¶ˆæ¯åˆ—è¡¨é“¾æ¥

ä¿®æ”¹äº† `components/messages/messages-list.tsx`ï¼š

```typescript
// ä¿®å¤å‰
<Link href={`/messages/${conversationId}`}>

// ä¿®å¤å
<Link href={`/messages/${conversation.product.id}/${conversation.partner.id}`}>
```

### 5. åˆ é™¤æ—§è·¯ç”±æ–‡ä»¶

åˆ é™¤äº† `app/messages/[conversationId]/page.tsx` ä»¥é¿å…è·¯ç”±å†²çªã€‚

## æŠ€æœ¯å®ç°

### 1. è·¯ç”±å‚æ•°å¤„ç†

#### **æ—§æ–¹å¼**:
```typescript
// éœ€è¦æ‰‹åŠ¨è§£æ
const [productId, partnerId] = params.conversationId.split("-")
if (!productId || !partnerId) {
  notFound()
}
```

#### **æ–°æ–¹å¼**:
```typescript
// ç›´æ¥ä½¿ç”¨åˆ†ç¦»çš„å‚æ•°
const { productId, partnerId } = params
// æ— éœ€è§£æï¼Œæ›´å®‰å…¨
```

### 2. æƒé™éªŒè¯ä¼˜åŒ–

```typescript
// éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æƒé™æŸ¥çœ‹è¿™ä¸ªå¯¹è¯
const isProductOwner = product.seller_id === user.id
const isPartner = partnerId === user.id
const isBuyer = !isProductOwner && user.id !== partnerId

if (!isProductOwner && !isPartner && !isBuyer) {
  redirect("/marketplace")
}
```

### 3. é”™è¯¯å¤„ç†æ”¹è¿›

- æ›´æ¸…æ™°çš„å‚æ•°éªŒè¯
- æ›´å¥½çš„æƒé™æ£€æŸ¥
- ç»Ÿä¸€çš„é”™è¯¯é‡å®šå‘

## éƒ¨ç½²æ­¥éª¤

### 1. é‡å¯åº”ç”¨

ç¡®ä¿æ–°çš„è·¯ç”±ç”Ÿæ•ˆï¼š
```bash
npm run dev
```

### 2. æµ‹è¯•æ¶ˆæ¯åŠŸèƒ½

1. è®¿é—®å•†å“è¯¦æƒ…é¡µé¢
2. ç‚¹å‡»"è”ç³»å–å®¶"
3. å‘é€æ¶ˆæ¯
4. éªŒè¯é‡å®šå‘åˆ°æ­£ç¡®çš„å¯¹è¯é¡µé¢

### 3. æµ‹è¯•æ¶ˆæ¯åˆ—è¡¨

1. è®¿é—® `/messages` é¡µé¢
2. ç‚¹å‡»å¯¹è¯é¡¹ç›®
3. éªŒè¯è·³è½¬åˆ°æ­£ç¡®çš„å¯¹è¯é¡µé¢

## åŠŸèƒ½ç‰¹æ€§

### âœ… è·¯ç”±ä¼˜åŒ–
- **æ¸…æ™°ç»“æ„**: `productId/partnerId` æ ¼å¼
- **å‚æ•°åˆ†ç¦»**: æ— éœ€æ‰‹åŠ¨è§£æå‚æ•°
- **é¿å…å†²çª**: åˆ é™¤æ—§è·¯ç”±æ–‡ä»¶

### âœ… ç”¨æˆ·ä½“éªŒ
- **æ— 404é”™è¯¯**: æ¶ˆæ¯å‘é€åæ­£ç¡®é‡å®šå‘
- **å¿«é€Ÿå¯¼èˆª**: æ¶ˆæ¯åˆ—è¡¨é“¾æ¥æ­£å¸¸å·¥ä½œ
- **æƒé™æ§åˆ¶**: åªæœ‰ç›¸å…³ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å¯¹è¯

### âœ… æŠ€æœ¯ä¼˜åŠ¿
- **ç±»å‹å®‰å…¨**: æ˜ç¡®çš„å‚æ•°ç±»å‹
- **æ€§èƒ½æå‡**: å‡å°‘å­—ç¬¦ä¸²è§£æ
- **ç»´æŠ¤æ€§**: æ›´æ¸…æ™°çš„ä»£ç ç»“æ„

## æµ‹è¯•éªŒè¯

### åŠŸèƒ½æµ‹è¯•
- âœ… æ¶ˆæ¯å‘é€åæ­£ç¡®é‡å®šå‘
- âœ… æ¶ˆæ¯åˆ—è¡¨é“¾æ¥æ­£å¸¸å·¥ä½œ
- âœ… å¯¹è¯é¡µé¢æ­£å¸¸æ˜¾ç¤º
- âœ… æƒé™éªŒè¯æ­£å¸¸å·¥ä½œ

### è·¯ç”±æµ‹è¯•
- âœ… æ–°è·¯ç”±æ ¼å¼æ­£å¸¸å·¥ä½œ
- âœ… æ—§è·¯ç”±ä¸å†å¯ç”¨
- âœ… å‚æ•°ä¼ é€’æ­£ç¡®
- âœ… 404é”™è¯¯å·²è§£å†³

## æ€»ç»“

é€šè¿‡é‡æ–°è®¾è®¡æ¶ˆæ¯è·¯ç”±ç»“æ„ï¼ŒæˆåŠŸè§£å†³äº†å‘é€æ¶ˆæ¯å404çš„é—®é¢˜ï¼š

### âœ… å·²ä¿®å¤çš„é—®é¢˜
- **è·¯ç”±æ ¼å¼ä¸åŒ¹é…**: ç»Ÿä¸€ä½¿ç”¨ `productId/partnerId` æ ¼å¼
- **å‚æ•°è§£æé—®é¢˜**: ç›´æ¥ä½¿ç”¨åˆ†ç¦»çš„è·¯ç”±å‚æ•°
- **è·¯ç”±å†²çª**: åˆ é™¤æ—§è·¯ç”±æ–‡ä»¶ï¼Œé¿å…å†²çª
- **404é”™è¯¯**: æ¶ˆæ¯å‘é€åæ­£ç¡®é‡å®šå‘

### ğŸš€ æ–°åŠŸèƒ½ç‰¹æ€§
- æ¸…æ™°çš„è·¯ç”±ç»“æ„
- æ›´å¥½çš„æƒé™éªŒè¯
- æ”¹è¿›çš„é”™è¯¯å¤„ç†
- ç»Ÿä¸€çš„å¯¼èˆªä½“éªŒ

### ğŸ”’ å®‰å…¨ç‰¹æ€§
- å®Œæ•´çš„æƒé™éªŒè¯
- ç”¨æˆ·æ•°æ®éš”ç¦»
- å®‰å…¨çš„å¯¹è¯è®¿é—®
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

ç°åœ¨æ¶ˆæ¯åŠŸèƒ½å®Œå…¨æ­£å¸¸ï¼Œå‘é€æ¶ˆæ¯åä¸ä¼šå‡ºç°404é”™è¯¯ï¼Œç”¨æˆ·å¯ä»¥æ­£å¸¸æŸ¥çœ‹å¯¹è¯å†…å®¹ï¼